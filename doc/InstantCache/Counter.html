<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: InstantCache::Counter</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/instantcache_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/instantcache.rb">lib/instantcache.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="Blob.html">InstantCache::Blob</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-memcached_counter">::memcached_counter</a></li>
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-decr">#decr</a></li>
          
          <li><a href="#method-i-decrement">#decrement</a></li>
          
          <li><a href="#method-i-get">#get</a></li>
          
          <li><a href="#method-i-incr">#incr</a></li>
          
          <li><a href="#method-i-increment">#increment</a></li>
          
          <li><a href="#method-i-set">#set</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../History_txt.html">History.txt</a></li>
        
          <li class="file"><a href="../LICENCE_txt.html">LICENCE.txt</a></li>
        
          <li class="file"><a href="../Manifest_txt.html">Manifest.txt</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../InstantCache.html">InstantCache</a></li>
        
          <li><a href="../InstantCache/Blob.html">InstantCache::Blob</a></li>
        
          <li><a href="../InstantCache/Counter.html">InstantCache::Counter</a></li>
        
          <li><a href="../InstantCache/CounterIntegerOnly.html">InstantCache::CounterIntegerOnly</a></li>
        
          <li><a href="../InstantCache/Destroyed.html">InstantCache::Destroyed</a></li>
        
          <li><a href="../InstantCache/Exception.html">InstantCache::Exception</a></li>
        
          <li><a href="../InstantCache/IncompatibleType.html">InstantCache::IncompatibleType</a></li>
        
          <li><a href="../InstantCache/IncompleteException.html">InstantCache::IncompleteException</a></li>
        
          <li><a href="../InstantCache/LockInconsistency.html">InstantCache::LockInconsistency</a></li>
        
          <li><a href="../InstantCache/SharedOnly.html">InstantCache::SharedOnly</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">InstantCache::Counter</h1>

    <div id="description" class="description">
      
<p>Class for integer-only memcache cells, capable of atomic
increment/decrement.  Basically the same as <a href="Blob.html">Blob</a>,
except with a default reset value of zero and rawmode forced to true.</p>

<p>However, counters have some additional features:</p>
<ul><li>
<p>They may only be set to integer values;</p>
</li><li>
<p><tt><em>varname</em>_increment</tt> and <tt><em>varname</em>_decrement</tt>
methods, which provide access to the corresponding underlying memcache
atomic integer operations;</p>
</li><li>
<p>Decrementing stops at zero, and will not result in negative numbers (a
feature of memcache).</p>
</li></ul>

    </div><!-- description -->

    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      
      <!-- Constants -->
      <div id="constants-list" class="section">
        <h3 class="section-header">Constants</h3>
        <dl>
        
          <dt><a name="RESET_VALUE">RESET_VALUE</a></dt>
          
          <dd class="description"><p>When a cached ‘counter’ value is reset or cleared, that means
‘zero’.</p></dd>
          
        
        </dl>
      </div>
      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="memcached_counter-method" class="method-detail ">
          <a name="method-c-memcached_counter"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">memcached_counter(<i>symbol</i>[,...])</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">memcached_counter(<i>symbol</i>[,...]) { |symbol| ... }</span>
            
          </div>
          
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>Access method declarator for an interlocked shared integer memcache-backed
variable.</p>

<p>This declarator sets up several methods relating to the variable.  If the
name passed is <b><tt>:ivar</tt></b>, these methods are created for it:</p>
<dl class="rdoc-list"><dt><em>ivar</em></dt>
<dd>
<p>Normal read accessor (<em>e.g.</em>, <tt>obj.ivar</tt>). (See <a
href="Blob.html#method-i-get">Blob#get</a>)</p>
</dd><dt><em>ivar</em>_reset</dt>
<dd>
<p>Resets the cache variable to the default ‘uninitialised’ value. (See <a
href="Blob.html#method-i-reset">Blob#reset</a>)</p>
</dd><dt><em>ivar</em>_expiry</dt>
<dd>
<p>Returns the current cache lifetime (default 0). (See <a
href="Blob.html#attribute-i-expiry">Blob#expiry</a>)</p>
</dd><dt><em>ivar</em>_expiry=</dt>
<dd>
<p>Sets the cache lifetime. (See <a
href="Blob.html#attribute-i-expiry">Blob#expiry=</a>)</p>
</dd><dt><em>ivar</em>_lock</dt>
<dd>
<p>Tries to get an exclusive lock on the variable. (See <a
href="Blob.html#method-i-lock">Blob#lock</a>)</p>
</dd><dt><em>ivar</em>_unlock</dt>
<dd>
<p>Unlocks the variable if locked. (See <a
href="Blob.html#method-i-unlock">Blob#unlock</a>)</p>
</dd><dt><em>ivar</em>_destroyed?</dt>
<dd>
<p>Returns true if variable is disconnected from the cache and unusable. (See
<a href="Blob.html#method-i-destroyed-3F">Blob#destroyed?</a>)</p>
</dd><dt><em>ivar</em>_destroy!</dt>
<dd>
<p>Disconnects the variable from the cache and makes it unusable. (See <a
href="Blob.html#method-i-destroy-21">Blob#destroy!</a>)</p>
</dd></dl>

<p>(These are the same methods created for a <a
href="Blob.html#method-c-memcached_accessor">Blob::memcached_accessor</a>
declaration.)</p>

<p>In addition, the following counter-specific methods are created:</p>
<dl class="rdoc-list"><dt><em>ivar</em>_increment</dt>
<dd>
<p>Adds the specified value to the cache variable. (See <a
href="Counter.html#method-i-increment">Counter#increment</a>)</p>
</dd><dt><em>ivar</em>_incr</dt>
<dd>
<p>Alias for <tt><em>ivar</em>_increment</tt>.</p>
</dd><dt><em>ivar</em>_decrement</dt>
<dd>
<p>Subtracts from the cache variable. (See <a
href="Counter.html#method-i-decrement">Counter#decrement</a>)</p>
</dd><dt><em>ivar</em>_decr</dt>
<dd>
<p>Alias for <tt><em>ivar</em>_decrement</tt>.</p>
</dd></dl>

<h3>Arguments</h3>
<dl class="rdoc-list"><dt><em>symbol</em></dt>
<dd>
<p>As with other Ruby accessor declarations, the argument list consists of one
or more variable names represented as symbols (<em>e.g.</em>,
<tt>:variablename</tt>).</p>
</dd><dt><em>{block}</em></dt>
<dd>
<p>If a block is supplied, its return value must be a string, which will be
used as the name of the memcached cell backing the variable.  The argument
to the block is the name of the variable as passed to the accessor
declaration.</p>
</dd></dl>

<h3>Exceptions</h3>

<p><em>None.</em></p>
            

            
            <div class="method-source-code" id="memcached_counter-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 857</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">memcached_counter</span>(*<span class="ruby-identifier">args</span>, &amp;<span class="ruby-identifier">block</span>) ; <span class="ruby-keyword">end</span></pre>
            </div><!-- memcached_counter-source -->
            
          </div>

          

          
        </div><!-- memcached_counter-method -->

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">memcached_counter(<i>symbol</i>[,...])</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">memcached_counter(<i>symbol</i>[,...]) { |symbol| ... }</span>
            
          </div>
          
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>As with Blob#initialize, this is not intended to be called directly. 
Rather, instances are declared with the #memcached_counter class method.</p>

<h3>Arguments</h3>
<dl class="rdoc-list"><dt><em>symbol</em></dt>
<dd>
<p>As with other Ruby accessor declarations, the argument list consists of one
or more variable names represented as symbols (<em>e.g.</em>,
<tt>:variablename</tt>).</p>
</dd></dl>

<p>:call-seq:</p>
<dl class="rdoc-list"><dt><em>{block}</em></dt>
<dd>
<p>If a block is supplied, its return value must be a string, which will be
used as the name of the memcached cell backing the variable.  The argument
to the block is the name of the variable as passed to the accessor
declaration.</p>
</dd></dl>

<h3>Exceptions</h3>

<p><em>None.</em></p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 890</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">inival</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@rawmode</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="decr-method" class="method-detail method-alias">
          <a name="method-i-decr"></a>

          
          <div class="method-heading">
            <span class="method-name">decr</span><span
              class="method-args">(amt=1)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
          </div>

          

          
          <div class="aliases">
            Alias for: <a href="Counter.html#method-i-decrement">decrement</a>
          </div>
          
        </div><!-- decr-method -->

      
        <div id="decrement-method" class="method-detail ">
          <a name="method-i-decrement"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">decrement[(<i>by_amount</i>)] => <i>Integer</i></span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>Decrement a memcached cell.  This <b>only</b> works in raw mode, which is
why it’s in this class rather than <a href="Blob.html">Blob</a>, but
it’s implicitly atomic according to memcache semantics.</p>

<h3>Arguments</h3>
<dl class="rdoc-list"><dt><em>by_amount</em></dt>
<dd>
<p>An integer amount by which to reduce the value of the variable; default is
1.</p>
</dd></dl>

<h3>Exceptions</h3>
<dl class="rdoc-list"><dt><tt><a href="CounterIntegerOnly.html">InstantCache::CounterIntegerOnly</a></tt></dt>
<dd>
<p>The supplied value was not an integer, and the cache was not changed.</p>
</dd><dt><tt><a href="Destroyed.html">InstantCache::Destroyed</a></tt></dt>
<dd>
<p>Cache value instance has been destroyed and is no longer usable. The value
in the cache is unaffected.</p>
</dd></dl>
            

            
            <div class="method-source-code" id="decrement-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 993</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">decrement</span>(<span class="ruby-identifier">amt</span>=<span class="ruby-value">1</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Destroyed</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>) <span class="ruby-keyword">if</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroyed?</span>)
  <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">amt</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Integer</span>))
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">CounterIntegerOnly</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">ivar_name</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># TODO: Another instance of poor-man's-cache-location; see #reset</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">InstantCache</span>.<span class="ruby-identifier">cache_object</span>.<span class="ruby-identifier">decr</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">amt</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- decrement-source -->
            
          </div>

          
          <div class="aliases">
            Also aliased as: <a href="Counter.html#method-i-decr">decr</a>
          </div>
          

          
        </div><!-- decrement-method -->

      
        <div id="get-method" class="method-detail ">
          <a name="method-i-get"></a>

          
          <div class="method-heading">
            <span class="method-name">get</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>Fetch the cached value through the superclass, and convert it to integer. 
(Raw values get stored as strings, since they’re unmarshalled.)</p>

<h3>Arguments</h3>

<p><em>None.</em></p>

<h3>Exceptions</h3>
<dl class="rdoc-list"><dt><tt><a href="Destroyed.html">InstantCache::Destroyed</a></tt></dt>
<dd>
<p>Cache value instance has been destroyed and is no longer usable. The value
in the cache is unaffected. (From <a
href="Blob.html#method-i-get">Blob#get</a>)</p>
</dd></dl>
            

            
            <div class="method-source-code" id="get-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 910</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span>.<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- get-source -->
            
          </div>

          

          
        </div><!-- get-method -->

      
        <div id="incr-method" class="method-detail method-alias">
          <a name="method-i-incr"></a>

          
          <div class="method-heading">
            <span class="method-name">incr</span><span
              class="method-args">(amt=1)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
          </div>

          

          
          <div class="aliases">
            Alias for: <a href="Counter.html#method-i-increment">increment</a>
          </div>
          
        </div><!-- incr-method -->

      
        <div id="increment-method" class="method-detail ">
          <a name="method-i-increment"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">increment[(<i>by_amount</i>)] => <i>Integer</i></span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>Increment a memcached cell.  This <b>only</b> works in raw mode, which is
why it’s in this class rather than <a href="Blob.html">Blob</a>, but
it’s implicitly atomic according to memcache semantics.</p>

<h3>Arguments</h3>
<dl class="rdoc-list"><dt><em>by_amount</em></dt>
<dd>
<p>An integer amount by which to increase the value of the variable; default
is 1.</p>
</dd></dl>

<h3>Exceptions</h3>
<dl class="rdoc-list"><dt><tt><a href="CounterIntegerOnly.html">InstantCache::CounterIntegerOnly</a></tt></dt>
<dd>
<p>The supplied value was not an integer, and the cache was not changed.</p>
</dd><dt><tt><a href="Destroyed.html">InstantCache::Destroyed</a></tt></dt>
<dd>
<p>Cache value instance has been destroyed and is no longer usable. The value
in the cache is unaffected.</p>
</dd></dl>
            

            
            <div class="method-source-code" id="increment-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 959</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">increment</span>(<span class="ruby-identifier">amt</span>=<span class="ruby-value">1</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Destroyed</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>) <span class="ruby-keyword">if</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">destroyed?</span>)
  <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">amt</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Integer</span>))
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">CounterIntegerOnly</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">ivar_name</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># TODO: Another instance of poor-man's-cache-location; see #reset</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">InstantCache</span>.<span class="ruby-identifier">cache_object</span>.<span class="ruby-identifier">incr</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">amt</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- increment-source -->
            
          </div>

          
          <div class="aliases">
            Also aliased as: <a href="Counter.html#method-i-incr">incr</a>
          </div>
          

          
        </div><!-- increment-method -->

      
        <div id="set-method" class="method-detail ">
          <a name="method-i-set"></a>

          
          <div class="method-heading">
            <span class="method-name">set</span><span
              class="method-args">(val)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <h3>Description</h3>

<p>Store a value as an integer, and return the value as stored. See <a
href="Blob.html#method-i-set">Blob#set</a> for the significance of this
operation.</p>

<h3>Arguments</h3>
<dl class="rdoc-list"><dt><em>val</em></dt>
<dd>
<p>New value to be stored in the cached cell.</p>
</dd></dl>

<h3>Exceptions</h3>
<dl class="rdoc-list"><dt><tt><a href="CounterIntegerOnly.html">InstantCache::CounterIntegerOnly</a></tt></dt>
<dd>
<p>The supplied value was not an integer, and was not stored.</p>
</dd><dt><tt><a href="Destroyed.html">InstantCache::Destroyed</a></tt></dt>
<dd>
<p>Cache value instance has been destroyed and is no longer usable. The value
in the cache is unaffected.</p>
</dd></dl>
            

            
            <div class="method-source-code" id="set-source">
<pre>
<span class="ruby-comment"># File lib/instantcache.rb, line 930</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">val</span>)
  <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">val</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Integer</span>))
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">CounterIntegerOnly</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">ivar_name</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span>(<span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- set-source -->
            
          </div>

          

          
        </div><!-- set-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

